---
title: "Retorno sobre o investimento em um MBA"
html_document:
  toc: true
  theme: united
---

```{r include = FALSE}
library(dplyr)
```

# Objetivo

O objetivo desta análise é verificar se existe retorno financeiro em realizar um curso de MBA.

Desejamos saber se uma estudante com as características abaixo deve investir na realização do curso, determinando qual será o seu salário após a graduação.

## A estudante possui as caracteristicas abaixo:

A) Mulher
B) Língua mãe não é o inglês
C) GMAT 680-700
D) Aluna de 1o quartil
E) 8 anos de experiência
F) 29 anos

## Dados da amostragem

Os seguintes dados, de 274 estudantes observados, foram coletados.

```{r}
mba <- read.csv("data/mba.csv", stringsAsFactors = FALSE)
names(mba)
```

## As variáveis de interesse presentes na amostragem são:

A) **sex**, o sexo da estudante, no caso feminino. Temos codificada esta informação com os valores 1 (masculino) ou 2 (feminino).
B) **frstlang**, first language, se a língua mãe é inglesa ou não. Temos codificada esta informação com os valores 1 (língua mãe é inglês) ou 2 (língua mãe **não** é inglês).
C) **gmat_tot**, o valor total que o estudante obteve no GMAT.
D) **quarter**, em que quartil o estudante possui desempenho nos cursos já realizados.
E) **work_yrs**, a quantidade em anos que o estudante possui de experiência.
F) **age**, a idade em anos do estudante.


# Análise exploratória do salário

Desejamos saber qual o salário de um ex-estudante após se formar.
Este atributo corresponde à variável **salary** em nossa base.

## Uma análise exploratória sumarisa o salário como:

Média salarial: 
```{r}
mean(mba$salary)
```

Mediana salarial:
```{r}
median(mba$salary)
```

Histograma salário:
```{r}
hist(mba$salary)
```

## Valores de salário inválidos.

A discrepância entre a média e a mediana leva ao questionamento dos valores salariais.

Existem salários com os valores 998 e 999. Estes valores são utilizados na amostragem para denotar profissionais não alocados.
Assim, estas observações, com valores 998 e 999, serão excluídas da análise.

```{r}
mba2 <- mba %>% filter(salary != 998 & salary != 999)
```

## Os dados da amostragem após a filtragem possuem o perfil:

```{r}
mean(mba2$salary)
median(mba2$salary)
hist(mba2$salary)
```

## Valores de salário com zero.

Vemos ainda que que existem salários com valores não realisticos (zero).
Explorando a base de dados podemos constatar observações com valor igual a zero, totalizando 90 de um total de 193.

```{r}
length(mba2$salary)
sum(mba2$salary == 0)
```

Filtramos a amostragem retirando também estas amostras.

```{r}
mba3 <- mba2 %>% filter(salary != 0)
```

## Os dados da amostra resultante possuem o perfil abaixo, mais próximo ao esperado.

```{r}
mean(mba3$salary)
median(mba3$salary)
hist(mba3$salary)
```

# Análises de relevância

Neste ponto, desejamos identificar quais variáveis influenciam ou não o salário.
Assim, iremos realizar uma análise de relevância para as variáveis que conhecemos da estudante alvo.

## Gênero influencia no salário?

Desejamos saber se o gênero influencia no salário final. Iremos neste caso utilizar o teste "One way ANOVA".
Temos portanto:

- Hipótese Nula, H_0: salário não é influenciada pelo gênero.
- Hipótese Alternativa, H_A: salário é influenciada pelo gênero.

```{r}
boxplot(formula = mba3$salary ~ mba3$sex)
oneway.test(mba3, formula = salary ~ sex)
```

Verificamos que existe um salário que é um outlier, correspondente à uma executiva empregada em um grupo pertencente a sua familia, sendo assim estatisticamente distorcivo.

Retiramos portanto a observação do outlier feminino
```{r}
mba4 <- filter(mba3, salary != max(mba3$salary))
```

Sem o outlier feminino, podemos realizar o teste novamente e constatar a relevância do gênero para a análise
```{r}
boxplot(formula = mba4$salary ~mba4$sex)
oneway.test(mba4, formula = salary ~ sex)
```

Com p-value perto de 0, concluímos que o salário é influenciado pelo gênero.

## Língua materna

Desejamos saber se a língua materna influencia no salário final. 
Uma primeira análise das observações mostra um número estatisticamente baixo de estudantes que não possuem a língua inglesa como lingua mãe (apenas 6 do total de 102 observações)
Assim, optamos por não utilizar esta variável na análise.

```{r}
# 1 - inglês | 2 - outros
unique(mba4$frstlang)
sum(mba4$frstlang == 1)
sum(mba4$frstlang == 2)

```

## Quartil

O desempenho passado do estudante pode ou não influenciar no salário. Os alunos são divididos nos 4 quartis e seu salário analisado abaixo.

```{r}
boxplot(mba4$salary ~ mba4$quarter)
```

Vista a diferença entre os quartis, decidimos por continuar com esta variável em nossa análise.

# Modelos de regressão

Os modelos de regressão serão utilizados para validar ou invalidar diversas hipóteses.
As principais perguntas são se uma variável impacta ou não no salário do profissional.
Assim, via de regra, teremos como hipótese Nula que esta variável não impacta, e como hipótese alternativa que dada variável impacta no salário.
Abaixo analisamos as variáveis.

## Modelo 1 (Salário ~ Quartil)

Teste de hipótese:
- H_0: O quartil de performance do aluno não influencia o seu salário.
- H_A: O quartil de performance do aluno influência o salário.

```{r}
modelo1 <- lm(mba4, formula = salary ~ quarter)
summary(modelo1)
```

Como o p-value para esta análise possui valor abaixo de 0,05, optamos por considerar o quartil no possível modelo preditivo do salário.

## Modelo 2 (Salário x Anos de Experiência)

Teste de hipótese:
- H_0: Os anos de experiência não influenciam no salário.
- H_A: Os anos de experiência influenciam no salário.

```{r}
modelo2 <- lm(mba4, formula = salary ~ work_yrs)
summary(modelo2)
```

Como o p-value para esta análise possui valor abaixo de 0,05, optamos por considerar os anos de experiência no possível modelo preditivo do salário.

## Modelo 3 (Salário x Idade)
- H_0: A idade não influencia no salário.
- H_A: A idade influencia no salário.

```{r}
modelo3 <- lm(mba4, formula = salary ~ age)
summary(modelo3)
```

Visto que o p-value para esta análise possui valor abaixo de 0,05, optamos por considerar a idade no possível modelo preditivo final do salário.

## Modelo 4 (Salário x Anos de experiência e Idade)

Dado que entendemos que a idade e a experiência do aluno podem estar potencialmente correlacionadas, analisamos a influência de ambas as variáveis em conjunto.

- H_0: A idade e os anos de experiência não influenciam no salário.
- H_A: A idade e os anos de experiência influenciam no salário.

```{r}
modelo4 <- lm(mba4, formula = salary ~ work_yrs + age)
summary(modelo4)
```

Vemos que, quando analisadas em conjunto, os anos de experiência possuem um valor p de 0,91.
Porém, como individualmente os anos de experiência são relevantes, e dado que a idade é um fator aparentemente refletido nos anos de experiência, optamos por não utilizar a idade no possível modelo.

## Modelo 5 (Salário x Sexo, Anos de experiência e quartil de performance)

Buscamos enriquecer o modelo preditivo com 3 variáveis, sexo, anos de experiência e quartil de performance.

- H_0: A svariáveis em conjunto não influenciam no salário.
- H_A: As variáveis em conjunto influenciam no salário.

```{r}
modelo5 <- lm(mba4, formula = salary ~ sex + work_yrs + quarter)
summary(modelo5)
```
Podemos verificar valores p abaixo de 0,05, com aumento da qualidade preditiva. Assim manteremos como modelo candidato o modelo5.

## Modelo 6 (Salário x Sexo, Anos de experiência, quartil de performance e GMAT Total)

Buscamos enriquecer o modelo preditivo, que além das 3 variáveis acima, pode também conter o GMAT do estudante.

```{r}
modelo6 <- lm(mba4, formula = salary ~ sex + work_yrs + quarter + gmat_tot)
summary(modelo6)
```

Verifica-se que a inclusão do GMAT não é relevante, possuindo um valor p de 0,42.

# Conclusão

Concluimos que dentre as variáveis estudadas, temos abaixo que:

## Influencial no resultado:
- Sexo
- Quartil
- Idade

## Não influenciam
- GMAT

## Covariância
- Idade e Anos de Experiência, eliminado Idade.

## Não conclusivos
- Lingua materna

## Valor experado

De posso do modelo final (Modelo5), o valor esperado pela estudante, ao final de seu MBA será de XXXXX.
Em um intervalo de confiança de 95%, o salário da candidata é entre YYYYY e ZZZZZ.

```{r}
sex <- 2
work_yrs <- 8
quarter <- 1
salary <- 107057.65 - 9977.52 * sex + 932.41 * work_yrs - 3388.7 * quarter

salary
```















